<!DOCTYPE html>
<html lang=en>
<head>
<meta charset=UTF-8>
<meta http-equiv=X-UA-Compatible content="IE=edge">
<meta name=viewport content="width=device-width, initial-scale=1.0">
<meta http-equiv=Content-Security-Policy content=upgrade-insecure-requests />
<script src=https://telegram.org/js/telegram-web-app.js></script>
<title>Доставка пиццы</title>
</head>
<style>header{background:#fff;position:relative;left:0;width:100%;z-index:3;width:100%}.wrap-header{background-color:#d0c9c0;padding:8px;position:relative;display:flex;justify-content:space-between;box-shadow:rgba(100,100,111,0.2) 0 7px 29px 0}.sticky{position:fixed;top:0;width:100%}.products{max-width:100%;max-height:100%;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;font-size:16px;line-height:22px;font-weight:700;color:#373a36;flex-grow:1;max-height:44px;margin-top:10px;overflow:hidden}.goods{border:1px solid #878480;border-radius:8px;opacity:1;margin:10px;padding:8px;display:flex;flex-direction:column;align-items:center;box-shadow:rgba(17,12,46,0.15) 0 48px 100px 0}img{max-width:100%;max-height:100%}.size{display:flex;flex-direction:row;flex-wrap:wrap;align-content:stretch;justify-content:flex-start;align-items:center;margin:5px}.variant{border:1px solid #878480;border-radius:8px;margin:10px;padding:10px;display:flex;flex-direction:column}button{align-items:center;background-color:#fff;border:1px solid rgba(0,0,0,0.1);border-radius:8px;box-shadow:rgba(0,0,0,0.02) 0 1px 3px 0;box-sizing:border-box;color:rgba(0,0,0,0.85);cursor:pointer;display:inline-flex;font-family:system-ui,-apple-system,system-ui,"Helvetica Neue",Helvetica,Arial,sans-serif;font-size:16px;font-weight:600;justify-content:center;line-height:1.25;margin:0;min-height:3rem;padding:calc(.875rem - 1px) calc(1.5rem - 1px);position:relative;text-decoration:none;transition:all 250ms;user-select:none;-webkit-user-select:none;touch-action:manipulation;vertical-align:baseline;width:auto}button:hover,button:focus{border-color:rgba(0,0,0,0.15);box-shadow:rgba(0,0,0,0.1) 0 4px 12px;color:rgba(0,0,0,0.65)}button:hover{transform:translateY(-1px)}button:active{background-color:#f0f0f1;border-color:rgba(0,0,0,0.15);box-shadow:rgba(0,0,0,0.06) 0 2px 4px;color:rgba(0,0,0,0.65);transform:translateY(0)}.button-17{margin:8px;align-items:center;appearance:none;background-color:#fff;border-radius:24px;border-style:none;box-shadow:rgba(0,0,0,.2) 0 3px 5px -1px,rgba(0,0,0,.14) 0 6px 10px 0,rgba(0,0,0,.12) 0 1px 18px 0;box-sizing:border-box;color:#3c4043;cursor:pointer;display:inline-flex;fill:currentcolor;font-family:"Google Sans",Roboto,Arial,sans-serif;font-size:14px;font-weight:500;height:48px;justify-content:center;letter-spacing:.8px;line-height:normal;max-width:100%;overflow:visible;padding:2px 12px;position:relative;text-align:center;text-transform:none;transition:box-shadow 280ms cubic-bezier(.4,0,.2,1),opacity 15ms linear 30ms,transform 270ms cubic-bezier(0,0,.2,1) 0ms;user-select:none;-webkit-user-select:none;touch-action:manipulation;width:auto;will-change:transform,opacity;z-index:0}.button-17:hover{background:#f6f9fe;color:#a93608}.button-17:active{box-shadow:0 4px 4px 0 rgb(60 64 67 / 30%),0 8px 12px 6px rgb(60 64 67 / 15%);outline:0}.button-17:focus{outline:0;border:2px solid #935508}.button-17:not(:disabled){box-shadow:rgba(60,64,67,.3) 0 1px 3px 0,rgba(60,64,67,.15) 0 4px 8px 3px}.button-17:not(:disabled):hover{box-shadow:rgba(60,64,67,.3) 0 2px 3px 0,rgba(60,64,67,.15) 0 6px 10px 4px}.button-17:not(:disabled):focus{box-shadow:rgba(60,64,67,.3) 0 1px 3px 0,rgba(60,64,67,.15) 0 4px 8px 3px}.button-17:not(:disabled):active{box-shadow:rgba(60,64,67,.3) 0 4px 4px 0,rgba(60,64,67,.15) 0 8px 12px 6px}.button-17:disabled{box-shadow:rgba(60,64,67,.3) 0 1px 3px 0,rgba(60,64,67,.15) 0 4px 8px 3px}.cat-filter{display:none}.canvas{display:none;position:fixed;z-index:5;left:0;top:0;width:100%;height:100%;overflow:auto;background-color:#000;background-color:rgba(0,0,0,0.4)}.modal{z-index:9;display:none;position:fixed;background-color:#eadfd6;border-radius:8px;margin:0;padding:6px;padding-bottom:10px;border:1px solid #161313;top:10%;width:90%;box-shadow:0 4px 8px 0 rgba(0,0,0,0.2),0 6px 20px 0 rgba(0,0,0,0.19);animation-name:animatetop;animation-duration:.4s;font-size:16px}@keyframes animatetop{from{top:100%;opacity:0}to{top:10%;opacity:1}}.cart-title{display:flex;align-items:center;flex-wrap:nowrap;flex-direction:row;justify-content:center}#buy-btn{display:flex;align-items:center;flex-wrap:nowrap;flex-direction:row;justify-content:center;background-color:#3aab3a;display:none}#CartDetail{padding:8px;padding-bottom:10px;display:none;flex-direction:column;flex-wrap:nowrap;justify-content:flex-start}#modalClose{background-color:#cf7f7f}.warning{display:none;z-index:999;position:fixed;min-height:80%;left:0;top:10%;width:100%;background-color:#d28c8c;font-size:28px;padding:10px}.name{font-size:28px;font-weight:bolder;color:#7b5e49;background-color:#d0c9c0;padding:10px;border-radius:15px;margin:5px}.cartSKU{display:flex;flex-direction:row;flex-wrap:nowrap;justify-content:space-between;align-items:center}img{border:1px solid rgba(0,0,0,0.1);border-radius:6px}.card-wrapper{width:50%;height:auto;display:flex;flex-direction:row;justify-content:space-between}.card{border:1px solid rgba(0,0,0,0.1);border-radius:8px;box-shadow:rgba(0,0,0,0.02) 0 1px 3px 0;box-sizing:border-box;margin:4px;padding:4px;display:flex;flex-direction:column;justify-content:space-between}.prodCategoryList{display:flex;flex-direction:row;flex-wrap:wrap}html{scroll-padding-top:150px;scroll-behavior:smooth}</style>
<body>
<header class=header id=myHeader>
<div class=wrap-header>
<span id=back><button onclick=BackButton()><</button></span>
<span id=cart><button onclick=OpenCart()><svg width=24 height=24 stroke-width=1.5 viewBox="0 0 24 24" fill=none xmlns=http://www.w3.org/2000/svg> <path d="M22 12.5L21.1667 15M21.1667 15L20 18.5H15.5L14.5 15H21.1667Z" stroke=currentColor stroke-linecap=round stroke-linejoin="round"/> <path d="M16.5 20.51L16.51 20.4989" stroke=currentColor stroke-linecap=round stroke-linejoin="round"/> <path d="M19.5 20.51L19.51 20.4989" stroke=currentColor stroke-linecap=round stroke-linejoin="round"/> <path d="M9 11C11.2091 11 13 9.20914 13 7C13 4.79086 11.2091 3 9 3C6.79086 3 5 4.79086 5 7C5 9.20914 6.79086 11 9 11Z" stroke=currentColor stroke-linecap=round stroke-linejoin="round"/> <path d="M2 18C2 14.134 5.13401 11 9 11C10.635 11 12.1391 11.5606 13.3306 12.5" stroke=currentColor stroke-linecap=round stroke-linejoin="round"/> </svg> <span id=cartSum></span></button></span>
</div>
</header>
<div id=catList>
</div>
<div id=products>
</div>
<div class=warning></div>
</body>
<script>let tg
let tguser
function warning(text){let el=document.getElementsByClassName('warning')[0]
el.innerHTML=text
el.style.display="block"}
try{tg=window.Telegram.WebApp
tguser=tg.initDataUnsafe.user.id}catch{}
let cart={user:tguser,total:0,items:{}}
let cartSum=0
let cartItems=0
function addCart(el){console.log(el.dataset.id)
let item={qua:0,price:parseInt(el.dataset.price),name:el.dataset.name}
if(cart.items[el.dataset.id]){cart.items[el.dataset.id].qua+=1}else{cart.items[el.dataset.id]=item
cart.items[el.dataset.id].qua=1}
cartSum+=parseInt(el.dataset.price)
cart["total"]=cartSum
updateCart()}
function addCartByID(id){console.log(id)
if(cart.items[id]){cart.items[id].qua+=1}else{cart.items[id]=item
cart.items[id].qua=1}
cartSum+=parseInt(cart.items[id].price)
cart["total"]=cartSum
updateCart()
ReViewCart()}
function remoteCartByID(id){console.log(id)
cartSum-=parseInt(cart.items[id].price)
cart["total"]=cartSum
if(cart.items[id].qua>1){cart.items[id].qua-=1}else{delete cart.items[id]
document.getElementById(`cartSKU${id}`).remove()}
updateCart()
ReViewCart()}
function updateCart(){document.getElementById("cartSum").innerHTML=cartSum}
let dat
async function ReqProdList(){const res=await fetch('https://back-pizza.jshi.ru/api/foods/?city_id=3');if(res.status==200){const data=await res.json();console.log(data)
renderData(data)}}
function renderData(data){let html=''
let catListHTML=''
data.data.forEach(el=>{d1=''
el.foodProperties.forEach(prod=>{d1+=`<div class='card-wrapper'><div class='card'><img src='${prod.img}'><div class='prodName'>${prod.name}</div><div class='prodPrice'>${prod.price}руб</div><button>В корзину</button></div></div>`})
catListHTML+=`<a href="#${el.id}"><button class="button-17">${el.name}</button></a>`;html+=`<h3 id="${el.id}">${el.name}</h3><div class='prodCategoryList'>${d1}</div>`});document.getElementById('products').innerHTML=html
document.getElementById('catList').innerHTML=catListHTML}
function ClearCard(){cart={user:tguser,total:0,items:{}}
cartSum=0
updateCart()
OpenCart()}
window.onscroll=function(){FixHeader()};var header=document.getElementById("myHeader");var sticky=header.offsetTop;function FixHeader(){if(window.pageYOffset>sticky){header.classList.add("sticky");}else{header.classList.remove("sticky");}}
function BackButton(){tg.close();}
var canvas=document.getElementById("canvas");var modal=document.getElementById("modal");var btn=document.getElementById("modalClose");function Variant(p){canvas.style.display="block";modal.style.display="block";}
window.onclick=function(event){if(event.target==canvas||event.target==btn){canvas.style.display="none";modal.style.display="none";document.getElementById("CartDetail").style.display="none";}}
function OpenCart(){canvas.style.display="block";document.getElementById("CartDetail").style.display="flex";ReViewCart()}
function ReViewCart(){if(cart.total>0){document.getElementById("buy-btn").style.display="block";document.getElementById("CartDetailData").innerHTML=''
data=''
Object.keys(cart.items).forEach(el=>{data+=`<p class='cartSKU'id='cartSKU${el}'>${cart.items[el].name},${cart.items[el].price}RUB<button onclick="remoteCartByID(${el})">-</button>${cart.items[el].qua}<button onclick="addCartByID(${el})">+</button></p>`});data+=`<p>Total<b>${cart.total}</b>RUB</p>`;document.getElementById("CartDetailData").innerHTML+=data}else{document.getElementById("CartDetailData").innerHTML='Empty'}}
window.onload=ReqProdList()</script>
</html>